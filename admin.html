<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - Hegir Store</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0D0D0D;
            --text-white: #FFFFFF;
            --text-light: #E5E5E5;
            --accent-primary: #0066FF;
            --accent-secondary: #00AAFF;
            --card-bg: #1A1A1A;
            --success: #00CC88;
            --warning: #FF9500;
            --error: #FF4444;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            line-height: 1.6;
        }
        
        /* Header */
        header {
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(13, 13, 13, 0.98);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-white);
            text-decoration: none;
            letter-spacing: -1px;
        }
        
        .logo span {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .nav-links a {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .nav-links a:hover {
            color: var(--accent-primary);
        }
        
        .nav-links a.active {
            color: var(--accent-primary);
        }
        
        /* Admin Container */
        .admin-container {
            padding: 2rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .admin-header {
            margin-bottom: 2rem;
        }
        
        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        /* Tabs */
        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 0.5rem;
        }
        
        .admin-tab {
            padding: 0.8rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 8px;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .admin-tab:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .admin-tab.active {
            background: rgba(0, 102, 255, 0.1);
            color: var(--accent-primary);
        }
        
        /* Products Table */
        .products-table-container {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .table-actions {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 102, 255, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-light);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-danger {
            background: rgba(255, 68, 68, 0.1);
            color: var(--error);
            border: 1px solid rgba(255, 68, 68, 0.2);
        }
        
        .btn-danger:hover {
            background: rgba(255, 68, 68, 0.2);
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .products-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .products-table th {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-white);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .products-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .products-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .product-image-cell {
            width: 80px;
        }
        
        .product-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.1), rgba(0, 170, 255, 0.05));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .product-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }
        
        .stock-cell {
            width: 100px;
        }
        
        .stock-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .stock-high {
            background: rgba(0, 204, 136, 0.2);
            color: var(--success);
        }
        
        .stock-medium {
            background: rgba(255, 149, 0, 0.2);
            color: var(--warning);
        }
        
        .stock-low {
            background: rgba(255, 68, 68, 0.2);
            color: var(--error);
        }
        
        .actions-cell {
            width: 150px;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .edit-btn {
            background: rgba(0, 102, 255, 0.1);
            color: var(--accent-primary);
        }
        
        .edit-btn:hover {
            background: rgba(0, 102, 255, 0.2);
        }
        
        .delete-btn {
            background: rgba(255, 68, 68, 0.1);
            color: var(--error);
        }
        
        .delete-btn:hover {
            background: rgba(255, 68, 68, 0.2);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 12px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--text-white);
        }
        
        .form-input, .form-select, .form-textarea {
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-white);
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: var(--transition);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .image-upload {
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .image-upload:hover {
            border-color: var(--accent-primary);
            background: rgba(0, 102, 255, 0.05);
        }
        
        .image-upload i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--accent-primary);
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
        }
        
        .image-preview.visible {
            display: block;
        }
        
        .specs-container {
            margin-top: 1rem;
        }
        
        .spec-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.8rem;
            align-items: center;
        }
        
        .spec-input {
            flex: 1;
        }
        
        .add-spec-btn {
            margin-top: 0.5rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            background: var(--card-bg);
            border-left: 4px solid var(--accent-primary);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 4000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: var(--success);
        }
        
        .notification.error {
            border-left-color: var(--error);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .table-actions {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .admin-container {
                padding: 1rem;
            }
            
            .admin-tabs {
                flex-wrap: wrap;
            }
            
            .modal {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <a href="index-shop.html" class="logo">HEG<span>IR</span> ADMIN</a>
        <div class="nav-links">
            <a href="index-shop.html" class="active">Товары</a>
            <a href="orders.html">Заказы</a>
            <a href="index-shop.html">Магазин</a>
            <a href="#" id="logout-btn">Выйти</a>
        </div>
    </header>

    <!-- Admin Container -->
    <main class="admin-container">
        <div class="admin-header">
            <h1>Админ-панель</h1>
            <p>Управление товарами и заказами магазина Hegir</p>
        </div>

        <!-- Stats -->
        <div class="admin-stats">
            <div class="stat-card">
                <div class="stat-value" id="total-products">0</div>
                <div class="stat-label">Всего товаров</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-stock">0</div>
                <div class="stat-label">Общий остаток</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="out-of-stock">0</div>
                <div class="stat-label">Нет в наличии</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-value">0 ₽</div>
                <div class="stat-label">Общая стоимость</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="products">Товары</button>
            <button class="admin-tab" data-tab="categories">Категории</button>
            <button class="admin-tab" data-tab="import">Импорт/Экспорт</button>
        </div>

        <!-- Products Tab -->
        <div class="admin-tab-content" id="products-tab">
            <div class="products-table-container">
                <div class="table-header">
                    <h3>Все товары</h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refresh-btn">
                            <i class="fas fa-sync-alt"></i> Обновить
                        </button>
                        <button class="btn btn-primary" id="add-product-btn">
                            <i class="fas fa-plus"></i> Добавить товар
                        </button>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="products-table" id="products-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th class="product-image-cell">Изображение</th>
                                <th>Название</th>
                                <th>Категория</th>
                                <th>Цена</th>
                                <th class="stock-cell">Остаток</th>
                                <th>Дата добавления</th>
                                <th class="actions-cell">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <!-- Товары загружаются динамически -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Categories Tab (скрыт по умолчанию) -->
        <div class="admin-tab-content" id="categories-tab" style="display: none;">
            <div class="products-table-container">
                <div class="table-header">
                    <h3>Категории товаров</h3>
                    <button class="btn btn-primary" id="add-category-btn">
                        <i class="fas fa-plus"></i> Добавить категорию
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Название</th>
                                <th>Кол-во товаров</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="categories-table-body">
                            <!-- Категории загружаются динамически -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Import/Export Tab (скрыт по умолчанию) -->
        <div class="admin-tab-content" id="import-tab" style="display: none;">
            <div class="products-table-container">
                <div class="table-header">
                    <h3>Импорт и экспорт данных</h3>
                </div>
                <div style="padding: 2rem;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin-bottom: 2rem;">
                        <div class="stat-card">
                            <h3 style="margin-bottom: 1rem;">Импорт из TXT</h3>
                            <p style="margin-bottom: 1rem; opacity: 0.8;">Загрузите текстовый файл с товарами в формате:</p>
                            <pre style="background: rgba(255,255,255,0.03); padding: 1rem; border-radius: 8px; font-size: 0.9rem; overflow-x: auto;">
Название|Категория|Цена|Количество|Описание
Пример: HEGIR PENISA P7|processors|89990|15|Флагманский процессор</pre>
                            <div style="margin-top: 1.5rem;">
                                <input type="file" id="import-txt-file" accept=".txt" style="display: none;">
                                <button class="btn btn-secondary" onclick="document.getElementById('import-txt-file').click()">
                                    <i class="fas fa-file-import"></i> Выбрать файл
                                </button>
                                <span id="selected-file" style="margin-left: 1rem; opacity: 0.7;"></span>
                            </div>
                            <button class="btn btn-primary" id="import-txt-btn" style="margin-top: 1rem; width: 100%;">
                                <i class="fas fa-upload"></i> Импортировать товары
                            </button>
                        </div>
                        
                        <div class="stat-card">
                            <h3 style="margin-bottom: 1rem;">Экспорт в JSON</h3>
                            <p style="margin-bottom: 1rem; opacity: 0.8;">Скачайте полную базу товаров в формате JSON:</p>
                            <div style="background: rgba(255,255,255,0.03); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-database" style="color: var(--accent-primary);"></i>
                                    <span>Товаров в базе: <strong id="export-count">0</strong></span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                                    <i class="fas fa-calendar" style="color: var(--accent-primary);"></i>
                                    <span>Последнее обновление: <strong id="last-update">-</strong></span>
                                </div>
                            </div>
                            <button class="btn btn-primary" id="export-json-btn" style="width: 100%;">
                                <i class="fas fa-file-export"></i> Экспортировать в JSON
                            </button>
                            <button class="btn btn-secondary" id="export-csv-btn" style="width: 100%; margin-top: 1rem;">
                                <i class="fas fa-file-csv"></i> Экспортировать в CSV
                            </button>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <h3 style="margin-bottom: 1rem;">Массовое обновление остатков</h3>
                        <p style="margin-bottom: 1rem; opacity: 0.8;">Загрузите CSV файл для обновления остатков товаров:</p>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="file" id="update-stock-file" accept=".csv" style="display: none;">
                            <button class="btn btn-secondary" onclick="document.getElementById('update-stock-file').click()">
                                <i class="fas fa-file-upload"></i> Выбрать CSV файл
                            </button>
                            <span id="selected-stock-file" style="opacity: 0.7;"></span>
                            <button class="btn btn-primary" id="update-stock-btn">
                                <i class="fas fa-sync-alt"></i> Обновить остатки
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Product Modal -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Добавить товар</h3>
                <button class="btn btn-secondary close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="product-name" class="form-label">Название товара *</label>
                            <input type="text" id="product-name" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-category" class="form-label">Категория *</label>
                            <select id="product-category" class="form-select" required>
                                <option value="">Выберите категорию</option>
                                <option value="processors">Процессоры</option>
                                <option value="laptops">Ноутбуки</option>
                                <option value="graphics">Видеокарты</option>
                                <option value="smartphones">Смартфоны</option>
                                <option value="vr">VR очки</option>
                                <option value="accessories">Аксессуары</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-price" class="form-label">Цена (₽) *</label>
                            <input type="number" id="product-price" class="form-input" min="0" step="100" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-stock" class="form-label">Количество *</label>
                            <input type="number" id="product-stock" class="form-input" min="0" required>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label">Изображение товара</label>
                            <div class="image-upload" id="image-upload-area">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Нажмите для загрузки изображения</p>
                                <p style="font-size: 0.9rem; opacity: 0.7;">Рекомендуемый размер: 800×600px</p>
                                <input type="file" id="product-image-input" accept="image/*" style="display: none;">
                            </div>
                            <img id="image-preview" class="image-preview" alt="Предпросмотр">
                            <input type="hidden" id="product-image-url">
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="product-description" class="form-label">Описание</label>
                            <textarea id="product-description" class="form-textarea"></textarea>
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label">Характеристики</label>
                            <div class="specs-container" id="specs-container">
                                <!-- Спецификации добавляются динамически -->
                            </div>
                            <button type="button" class="btn btn-secondary add-spec-btn" id="add-spec-btn">
                                <i class="fas fa-plus"></i> Добавить характеристику
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal">Отмена</button>
                <button class="btn btn-primary" id="save-product-btn">Сохранить товар</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // База данных
        let products = [];
        let categories = ['processors', 'laptops', 'graphics', 'smartphones', 'vr', 'accessories'];
        
        // DOM элементы
        const productsTableBody = document.getElementById('products-table-body');
        const categoriesTableBody = document.getElementById('categories-table-body');
        const adminTabs = document.querySelectorAll('.admin-tab');
        const tabContents = document.querySelectorAll('.admin-tab-content');
        const productModal = document.getElementById('product-modal');
        const productForm = document.getElementById('product-form');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const addProductBtn = document.getElementById('add-product-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const saveProductBtn = document.getElementById('save-product-btn');
        const imageUploadArea = document.getElementById('image-upload-area');
        const productImageInput = document.getElementById('product-image-input');
        const imagePreview = document.getElementById('image-preview');
        const addSpecBtn = document.getElementById('add-spec-btn');
        const specsContainer = document.getElementById('specs-container');
        const notification = document.getElementById('notification');
        const logoutBtn = document.getElementById('logout-btn');
        
        // Статистика
        const totalProductsEl = document.getElementById('total-products');
        const totalStockEl = document.getElementById('total-stock');
        const outOfStockEl = document.getElementById('out-of-stock');
        const totalValueEl = document.getElementById('total-value');
        const exportCountEl = document.getElementById('export-count');
        const lastUpdateEl = document.getElementById('last-update');
        
        // Импорт/Экспорт
        const importTxtFile = document.getElementById('import-txt-file');
        const importTxtBtn = document.getElementById('import-txt-btn');
        const exportJsonBtn = document.getElementById('export-json-btn');
        const exportCsvBtn = document.getElementById('export-csv-btn');
        const updateStockFile = document.getElementById('update-stock-file');
        const updateStockBtn = document.getElementById('update-stock-btn');
        const selectedFileEl = document.getElementById('selected-file');
        const selectedStockFileEl = document.getElementById('selected-stock-file');
        
        // Загрузка товаров
        async function loadProducts() {
            try {
                const response = await fetch('products.json');
                if (!response.ok) throw new Error('Не удалось загрузить товары');
                
                products = await response.json();
                updateProductsTable();
                updateStats();
                updateCategoriesTable();
            } catch (error) {
                showNotification('Ошибка загрузки товаров: ' + error.message, 'error');
                // Загружаем демо данные
                loadDemoProducts();
            }
        }
        
        // Демо данные
        function loadDemoProducts() {
            products = [
                {
                    id: 1,
                    name: "HEGIR PENISA P7-980KF",
                    category: "processors",
                    price: 89990,
                    stock: 15,
                    image: "https://via.placeholder.com/300x200/0066FF/FFFFFF?text=PENISA+P7",
                    description: "Флагманский процессор для настольных систем",
                    specs: [
                        { label: "Ядра/Потоки", value: "24/48" },
                        { label: "Частота", value: "до 5.2 GHz" }
                    ],
                    createdAt: "2023-10-01"
                }
            ];
            updateProductsTable();
            updateStats();
            updateCategoriesTable();
        }
        
        // Обновление таблицы товаров
        function updateProductsTable() {
            productsTableBody.innerHTML = '';
            
            if (products.length === 0) {
                productsTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 3rem;">
                            <i class="fas fa-box-open" style="font-size: 2rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                            <p>Товары не найдены</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            products.forEach(product => {
                // Определяем статус наличия
                let stockClass = 'stock-high';
                let stockText = product.stock;
                
                if (product.stock === 0) {
                    stockClass = 'stock-low';
                    stockText = 'Нет в наличии';
                } else if (product.stock < 5) {
                    stockClass = 'stock-medium';
                    stockText = `Мало (${product.stock})`;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td class="product-image-cell">
                        <div class="product-image">
                            <img src="${product.image}" alt="${product.name}"
                                 onerror="this.src='https://via.placeholder.com/60/1A1A1A/FFFFFF?text=Hegir'">
                        </div>
                    </td>
                    <td>${product.name}</td>
                    <td>${getCategoryName(product.category)}</td>
                    <td>${product.price.toLocaleString()} ₽</td>
                    <td class="stock-cell">
                        <span class="stock-badge ${stockClass}">${stockText}</span>
                    </td>
                    <td>${product.createdAt || 'Не указана'}</td>
                    <td class="actions-cell">
                        <div class="action-buttons">
                            <button class="action-btn edit-btn" data-id="${product.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" data-id="${product.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                productsTableBody.appendChild(row);
            });
            
            // Добавляем обработчики для кнопок
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.dataset.id);
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.dataset.id);
                    deleteProduct(productId);
                });
            });
        }
        
        // Обновление таблицы категорий
        function updateCategoriesTable() {
            categoriesTableBody.innerHTML = '';
            
            categories.forEach(category => {
                const productCount = products.filter(p => p.category === category).length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${getCategoryName(category)}</td>
                    <td>${productCount} товаров</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit-btn" data-category="${category}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" data-category="${category}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                categoriesTableBody.appendChild(row);
            });
        }
        
        // Получение названия категории
        function getCategoryName(categoryKey) {
            const categoryNames = {
                'processors': 'Процессоры',
                'laptops': 'Ноутбуки',
                'graphics': 'Видеокарты',
                'smartphones': 'Смартфоны',
                'vr': 'VR очки',
                'accessories': 'Аксессуары'
            };
            
            return categoryNames[categoryKey] || categoryKey;
        }
        
        // Обновление статистики
        function updateStats() {
            const totalProducts = products.length;
            const totalStock = products.reduce((sum, p) => sum + p.stock, 0);
            const outOfStock = products.filter(p => p.stock === 0).length;
            const totalValue = products.reduce((sum, p) => sum + (p.price * p.stock), 0);
            
            totalProductsEl.textContent = totalProducts;
            totalStockEl.textContent = totalStock;
            outOfStockEl.textContent = outOfStock;
            totalValueEl.textContent = totalValue.toLocaleString() + ' ₽';
            exportCountEl.textContent = totalProducts;
            lastUpdateEl.textContent = new Date().toLocaleDateString('ru-RU');
            
            // Обновляем магазин если он открыт
            if (typeof window.updateProducts === 'function') {
                window.updateProducts(products);
            }
        }
        
        // Редактирование товара
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('modal-title').textContent = 'Редактировать товар';
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-stock').value = product.stock;
            document.getElementById('product-image-url').value = product.image;
            document.getElementById('product-description').value = product.description || '';
            
            // Загружаем изображение
            imagePreview.src = product.image;
            imagePreview.classList.add('visible');
            
            // Загружаем характеристики
            specsContainer.innerHTML = '';
            if (product.specs && product.specs.length > 0) {
                product.specs.forEach((spec, index) => {
                    addSpecField(spec.label, spec.value);
                });
            }
            
            productModal.classList.add('active');
        }
        
        // Удаление товара
        function deleteProduct(productId) {
            if (!confirm('Вы уверены, что хотите удалить этот товар?')) return;
            
            const index = products.findIndex(p => p.id === productId);
            if (index !== -1) {
                products.splice(index, 1);
                updateProductsTable();
                updateStats();
                saveProducts();
                showNotification('Товар успешно удален', 'success');
            }
        }
        
        // Добавление поля характеристики
        function addSpecField(label = '', value = '') {
            const specDiv = document.createElement('div');
            specDiv.className = 'spec-item';
            specDiv.innerHTML = `
                <input type="text" class="form-input spec-input spec-label-input" 
                       placeholder="Название характеристики" value="${label}">
                <input type="text" class="form-input spec-input spec-value-input" 
                       placeholder="Значение" value="${value}">
                <button type="button" class="action-btn delete-btn remove-spec-btn">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            specsContainer.appendChild(specDiv);
            
            // Обработчик удаления характеристики
            specDiv.querySelector('.remove-spec-btn').addEventListener('click', function() {
                specDiv.remove();
            });
        }
        
        // Сохранение товаров в JSON
        async function saveProducts() {
            try {
                // В реальном проекте здесь будет отправка на сервер
                // Для примера сохраняем в localStorage
                localStorage.setItem('hegir_products_backup', JSON.stringify(products));
                
                // Обновляем файл products.json (в реальном проекте через API)
                showNotification('Товары сохранены', 'success');
            } catch (error) {
                showNotification('Ошибка сохранения: ' + error.message, 'error');
            }
        }
        
        // Импорт из TXT
        function importFromTxt(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n');
                let importedCount = 0;
                
                lines.forEach((line, index) => {
                    if (index === 0 || !line.trim()) return; // Пропускаем заголовок и пустые строки
                    
                    const parts = line.split('|');
                    if (parts.length >= 4) {
                        const name = parts[0].trim();
                        const category = parts[1].trim();
                        const price = parseInt(parts[2].trim());
                        const stock = parseInt(parts[3].trim());
                        const description = parts[4] ? parts[4].trim() : '';
                        
                        // Проверяем, существует ли уже такой товар
                        const existingIndex = products.findIndex(p => 
                            p.name.toLowerCase() === name.toLowerCase()
                        );
                        
                        if (existingIndex === -1) {
                            // Создаем новый товар
                            const newProduct = {
                                id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                                name: name,
                                category: category,
                                price: price,
                                stock: stock,
                                image: `https://via.placeholder.com/300x200/1A1A1A/FFFFFF?text=${encodeURIComponent(name)}`,
                                description: description,
                                specs: [],
                                createdAt: new Date().toISOString().split('T')[0]
                            };
                            
                            products.push(newProduct);
                            importedCount++;
                        } else {
                            // Обновляем существующий товар
                            products[existingIndex].price = price;
                            products[existingIndex].stock = stock;
                            if (description) {
                                products[existingIndex].description = description;
                            }
                        }
                    }
                });
                
                updateProductsTable();
                updateStats();
                saveProducts();
                
                showNotification(`Импортировано ${importedCount} товаров`, 'success');
            };
            
            reader.readAsText(file);
        }
        
        // Экспорт в JSON
        function exportToJson() {
            const dataStr = JSON.stringify(products, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = `hegir-products-${new Date().toISOString().split('T')[0]}.json`;
            downloadLink.click();
            
            showNotification('Файл JSON скачан', 'success');
        }
        
        // Экспорт в CSV
        function exportToCsv() {
            let csv = 'Название,Категория,Цена,Количество,Описание\n';
            
            products.forEach(product => {
                const row = [
                    `"${product.name}"`,
                    `"${getCategoryName(product.category)}"`,
                    product.price,
                    product.stock,
                    `"${product.description || ''}"`
                ];
                csv += row.join(',') + '\n';
            });
            
            const downloadLink = document.createElement('a');
            downloadLink.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            downloadLink.download = `hegir-products-${new Date().toISOString().split('T')[0]}.csv`;
            downloadLink.click();
            
            showNotification('Файл CSV скачан', 'success');
        }
        
        // Показать уведомление
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Проверка авторизации
            const user = JSON.parse(localStorage.getItem('hegir_user'));
            if (!user || !user.isAdmin) {
                showNotification('Требуется авторизация администратора', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
                return;
            }
            
            // Загружаем товары
            loadProducts();
            
            // Переключение вкладок
            adminTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Обновляем активную вкладку
                    adminTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Показываем соответствующий контент
                    tabContents.forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    document.getElementById(`${tabId}-tab`).style.display = 'block';
                });
            });
            
            // Открытие модального окна для добавления товара
            addProductBtn.addEventListener('click', function() {
                document.getElementById('modal-title').textContent = 'Добавить товар';
                productForm.reset();
                document.getElementById('product-id').value = '';
                imagePreview.src = '';
                imagePreview.classList.remove('visible');
                specsContainer.innerHTML = '';
                productModal.classList.add('active');
            });
            
            // Закрытие модального окна
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    productModal.classList.remove('active');
                });
            });
            
            // Закрытие модального окна при клике вне его
            document.addEventListener('click', function(event) {
                if (event.target === productModal) {
                    productModal.classList.remove('active');
                }
            });
            
            // Загрузка изображения
            imageUploadArea.addEventListener('click', function() {
                productImageInput.click();
            });
            
            productImageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // В реальном проекте здесь была бы загрузка на сервер
                    // Для примера создаем локальный URL
                    const imageUrl = URL.createObjectURL(file);
                    imagePreview.src = imageUrl;
                    imagePreview.classList.add('visible');
                    document.getElementById('product-image-url').value = imageUrl;
                }
            });
            
            // Добавление характеристики
            addSpecBtn.addEventListener('click', function() {
                addSpecField();
            });
            
            // Сохранение товара
            saveProductBtn.addEventListener('click', function() {
                const productId = document.getElementById('product-id').value;
                const name = document.getElementById('product-name').value;
                const category = document.getElementById('product-category').value;
                const price = parseInt(document.getElementById('product-price').value);
                const stock = parseInt(document.getElementById('product-stock').value);
                const image = document.getElementById('product-image-url').value;
                const description = document.getElementById('product-description').value;
                
                // Собираем характеристики
                const specs = [];
                document.querySelectorAll('.spec-item').forEach(item => {
                    const label = item.querySelector('.spec-label-input').value;
                    const value = item.querySelector('.spec-value-input').value;
                    if (label && value) {
                        specs.push({ label, value });
                    }
                });
                
                if (!name || !category || isNaN(price) || isNaN(stock)) {
                    showNotification('Заполните все обязательные поля', 'error');
                    return;
                }
                
                if (productId) {
                    // Редактирование существующего товара
                    const index = products.findIndex(p => p.id === parseInt(productId));
                    if (index !== -1) {
                        products[index] = {
                            ...products[index],
                            name,
                            category,
                            price,
                            stock,
                            image: image || products[index].image,
                            description,
                            specs
                        };
                    }
                } else {
                    // Добавление нового товара
                    const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                    products.push({
                        id: newId,
                        name,
                        category,
                        price,
                        stock,
                        image: image || `https://via.placeholder.com/300x200/1A1A1A/FFFFFF?text=${encodeURIComponent(name)}`,
                        description,
                        specs,
                        createdAt: new Date().toISOString().split('T')[0]
                    });
                }
                
                updateProductsTable();
                updateStats();
                saveProducts();
                productModal.classList.remove('active');
                
                showNotification(productId ? 'Товар обновлен' : 'Товар добавлен', 'success');
            });
            
            // Обновление товаров
            refreshBtn.addEventListener('click', function() {
                loadProducts();
                showNotification('Товары обновлены', 'success');
            });
            
            // Выход из системы
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('hegir_user');
                showNotification('Вы вышли из системы', 'success');
                setTimeout(() => {
                    window.location.href = 'index-shop.html';
                }, 1500);
            });
            
            // Импорт из TXT
            importTxtFile.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    selectedFileEl.textContent = e.target.files[0].name;
                }
            });
            
            importTxtBtn.addEventListener('click', function() {
                if (importTxtFile.files.length === 0) {
                    showNotification('Выберите файл для импорта', 'error');
                    return;
                }
                
                importFromTxt(importTxtFile.files[0]);
                importTxtFile.value = '';
                selectedFileEl.textContent = '';
            });
            
            // Экспорт в JSON
            exportJsonBtn.addEventListener('click', exportToJson);
            
            // Экспорт в CSV
            exportCsvBtn.addEventListener('click', exportToCsv);
            
            // Обновление остатков из CSV
            updateStockFile.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    selectedStockFileEl.textContent = e.target.files[0].name;
                }
            });
            
            updateStockBtn.addEventListener('click', function() {
                if (updateStockFile.files.length === 0) {
                    showNotification('Выберите CSV файл', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    const lines = content.split('\n');
                    let updatedCount = 0;
                    
                    lines.forEach((line, index) => {
                        if (index === 0 || !line.trim()) return;
                        
                        const parts = line.split(',');
                        if (parts.length >= 2) {
                            const name = parts[0].replace(/"/g, '').trim();
                            const stock = parseInt(parts[1].trim());
                            
                            const productIndex = products.findIndex(p => 
                                p.name.toLowerCase() === name.toLowerCase()
                            );
                            
                            if (productIndex !== -1 && !isNaN(stock)) {
                                products[productIndex].stock = stock;
                                updatedCount++;
                            }
                        }
                    });
                    
                    updateProductsTable();
                    updateStats();
                    saveProducts();
                    
                    showNotification(`Обновлено ${updatedCount} товаров`, 'success');
                    updateStockFile.value = '';
                    selectedStockFileEl.textContent = '';
                };
                
                reader.readAsText(updateStockFile.files[0]);
            });
        });
    </script>
</body>
</html>
